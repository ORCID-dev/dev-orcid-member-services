<div *ngIf="memberData" class="h-100">
  <div class="p-3 mb-3">
    <div class="go-back">
      Back to <a routerLink="">{{ memberData.publicDisplayName }}</a>
    </div>
    <hr class="mb-4" />
    <div class="edit-org-label mb-3 font-size-18 color-gray">Add new contact</div>
    <h1 class="mb-3 wide-text font-italic">New contact</h1>
  </div>
  <div class="d-flex">
    <div class="main-section">
      <form (ngSubmit)="save()" name="editForm" role="form" [formGroup]="editForm">
        <div *ngIf="invalidForm" class="warning d-flex w-75 p-3 mb-3">
          <img src="./../../../../content/images/warning-sign.svg" alt="Warning sign" class="p-2" />
          <div>
            <div class="mb-2 font-size-12 wide-text font-weight-bold">
              Your changes cannot be saved
            </div>
            <div class="font-size-12 wide-text">
              Please fix the issues with the public details before trying to save again
            </div>
          </div>
        </div>
        <h3 class="mb-3 wide-text">Contact details</h3>
        <div class="form mb-5">
          <div class="form-group w-50">
            <label class="wide-text font-size-12" [ngClass]="{ 'text-danger': editForm.get('firstName').invalid }"
              >First or given name</label
            >
            <input
              type="text"
              class="form-control"
              name="firstName"
              formControlName="firstName"
              [ngClass]="{ 'text-danger': editForm.get('firstName').invalid }"
            />
            <div *ngIf="editForm.get('firstName').invalid">
              <small class="wide-text font-size-12 form-text text-danger" *ngIf="editForm.get('firstName').errors.required">
                The organization name cannot be empty
              </small>
              <div>
                <small class="wide-text font-size-12 form-text text-danger" *ngIf="editForm.get('firstName').errors.maxlength">
                  Organization name is too long. Please use 255 characters or less.
                </small>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="wide-text font-size-12">Last or family name</label>
            <input
              type="text"
              class="form-control"
              name="lastName"
              formControlName="lastName"
              [ngClass]="{ 'text-danger': editForm.get('lastName').invalid }"
            />
            <div *ngIf="editForm.get('lastName').invalid">
              <small class="wide-text font-size-12 form-text text-danger" *ngIf="editForm.get('lastName').errors.maxlength">
                Organization description is too long. Please use 5000 characters or less.
              </small>
            </div>
          </div>
          <div class="form-group">
            <label class="wide-text font-size-12">Job title</label>
            <input
              type="text"
              class="form-control"
              name="title"
              formControlName="title"
              [ngClass]="{ 'text-danger': editForm.get('title').invalid }"
            />
            <div *ngIf="editForm.get('title').invalid">
              <small class="wide-text font-size-12 form-text text-danger" *ngIf="editForm.get('title').errors.maxlength">
                Organization description is too long. Please use 5000 characters or less.
              </small>
            </div>
          </div>
          <div class="form-group mb-4 w-50">
            <label [ngClass]="{ 'text-danger': editForm.get('email').invalid }" class="wide-text font-size-12">Email</label>
            <input
              type="text"
              class="form-control"
              name="email"
              formControlName="email"
              [ngClass]="{ 'text-danger': editForm.get('email').invalid }"
            />
            <ng-template #validEmail>
              <small class="wide-text font-size-12 color-gray">Emails should be in the standard format e.g. contactus@website.com</small>
            </ng-template>
            <div *ngIf="editForm.get('email').invalid; else validEmail">
              <small class="wide-text font-size-12 text-danger" *ngIf="editForm.get('email').errors.pattern">
                Please enter a valid email address, for example contactus@website.com
              </small>
              <div>
                <small class="wide-text font-size-12 text-danger" *ngIf="editForm.get('email').errors.maxlength">
                  Email is too long. Please use 80 characters or less.
                </small>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="wide-text font-size-12">Phone</label>
            <input
              type="text"
              class="form-control"
              name="phone"
              formControlName="phone"
              [ngClass]="{ 'text-danger': editForm.get('phone').invalid }"
            />
            <div *ngIf="editForm.get('phone').invalid">
              <small class="wide-text font-size-12 form-text text-danger" *ngIf="editForm.get('phone').errors.maxlength">
                Organization description is too long. Please use 5000 characters or less.
              </small>
            </div>
          </div>
          <h3 class="mb-0 mr-2">Roles</h3>
          <div formArrayName="roles">
            <div *ngFor="let myOption of roles.controls; let i = index">
              <div formGroupName="{{ i }}">
                <input type="checkbox" [formControl]="myOption.get('selected')" />
                <label> {{ myOption.get('name').value }} </label>
              </div>
              <div *ngIf="editForm.get('roles').invalid">
                <small class="wide-text font-size-12 form-text text-danger" *ngIf="editForm.get('roles').errors.required">
                  Organization description is too long. Please use 5000 characters or less.
                </small>
              </div>
            </div>
          </div>
          <button type="submit" [disabled]="isSaving" class="btn btn-primary">Save changes</button>
          <button type="button" class="btn btn-outline-primary" routerLink="/">Cancel</button>
        </div>
      </form>

      <div *ngIf="memberData.orgIds" class="identifiers">
        <div class="d-flex mb-2">
          <h3 class="mb-0 mr-2">Identifiers</h3>
        </div>
        <div class="wide-text font-size-12 coming-soon">
          <em
            >We did our best to register the right organization identifiers in our systems when you became an ORCID member. If you think any
            are missing (ROR, GRID, RINGGOLD or Funder Registry ID)
            <a href="mailto:membership@orcid.org">contact your engagement support lead</a> to register additional IDs</em
          >
        </div>
        <div class="row ml-0 d-flex justify-content-between contact">
          <h6 class="w-66">ID</h6>
          <h6 class="w-33">Type</h6>
        </div>
        <hr class="green-hr" />
        <ul class="ml-0 pl-0" *ngFor="let orgIdType of objectKeys(memberData.orgIds); let i = index">
          <div *ngFor="let orgId of memberData.orgIds[orgIdType]; let ii = index">
            <li class="row ml-0 d-flex justify-content-between contact">
              <div class="w-66">{{ orgId }}</div>
              <div class="w-33">{{ orgIdType }}</div>
            </li>
            <hr *ngIf="!(i == objectKeys(memberData.orgIds).length - 1 && ii == memberData.orgIds[orgIdType].length - 1)" />
          </div>
        </ul>
      </div>
      <div *ngIf="memberData.contacts" class="contacts">
        <div class="d-flex mb-2">
          <h3 class="mb-0 mr-2">Contacts</h3>
          <img class="lockpad" src="./../../../../content/images/lockpad.svg" alt="Locked" />
        </div>
        <div class="wide-text font-size-12 coming-soon">
          <em>Editable contacts coming soon</em>
        </div>
        <div class="row ml-0 d-flex justify-content-between contact">
          <h6>Name</h6>
          <h6>Member roles</h6>
          <h6>Email</h6>
          <h6>Phone</h6>
        </div>
        <hr class="green-hr" />
        <ul class="ml-0 pl-0" *ngFor="let contact of memberData.contacts; let i = index">
          <li class="row ml-0 d-flex justify-content-between contact">
            <div>
              <div>{{ contact.name }}</div>
              <div class="color-gray font-size-12">{{ contact.title }}</div>
            </div>
            <div>{{ contact.memberOrgRole.join(', ') }}</div>
            <div>
              <a href="mailto:{{ contact.contactEmail }}">{{ contact.contactEmail }}</a>
            </div>
            <div *ngIf="contact.phone">
              {{ contact.phone }}
            </div>
            <div *ngIf="!contact.phone">
              -
            </div>
          </li>
          <hr *ngIf="i + 1 < memberData.contacts.length" />
        </ul>
      </div>
      <div *ngIf="memberData.isConsortiumLead">
        <h3 class="mb-4 font-weight-bold">
          Consortium Members
          <span class="font-weight-normal">({{ memberData.consortiumMembers.length }})</span>
        </h3>
        <h6>Member name</h6>
        <hr class="green-hr" />
        <div *ngFor="let consortiumMember of memberData.consortiumMembers; let i = index">
          <div>{{ consortiumMember.name }}</div>
          <hr *ngIf="i + 1 < memberData.consortiumMembers.length" />
        </div>
      </div>
    </div>
  </div>
</div>

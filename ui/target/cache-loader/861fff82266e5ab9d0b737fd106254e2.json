{"remainingRequest":"C:\\prgr\\orcid-member-services\\gateway\\node_modules\\thread-loader\\dist\\cjs.js??ref--9-2!C:\\prgr\\orcid-member-services\\gateway\\node_modules\\ts-loader\\index.js??ref--9-3!C:\\prgr\\orcid-member-services\\gateway\\node_modules\\angular-router-loader\\src\\index.js!C:\\prgr\\orcid-member-services\\gateway\\node_modules\\tslint-loader\\index.js!C:\\prgr\\orcid-member-services\\gateway\\src\\main\\webapp\\app\\blocks\\interceptor\\auth-expired.interceptor.ts","dependencies":[{"path":"C:\\prgr\\orcid-member-services\\gateway\\src\\main\\webapp\\app\\blocks\\interceptor\\auth-expired.interceptor.ts","mtime":1663837715847},{"path":"C:\\prgr\\orcid-member-services\\gateway\\node_modules\\angular2-template-loader\\index.js","mtime":1663256168388},{"path":"C:\\prgr\\orcid-member-services\\gateway\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1663256170419},{"path":"C:\\prgr\\orcid-member-services\\gateway\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1663256168812},{"path":"C:\\prgr\\orcid-member-services\\gateway\\node_modules\\ts-loader\\index.js","mtime":1663256162409},{"path":"C:\\prgr\\orcid-member-services\\gateway\\node_modules\\angular-router-loader\\src\\index.js","mtime":1663256183091},{"path":"C:\\prgr\\orcid-member-services\\gateway\\node_modules\\tslint-loader\\index.js","mtime":1663256174695}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOw0KT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsNCmNvbnN0IHRzbGliXzEgPSByZXF1aXJlKCJ0c2xpYiIpOw0KdmFyIF9hLCBfYiwgX2M7DQpjb25zdCBjb3JlXzEgPSByZXF1aXJlKCJAYW5ndWxhci9jb3JlIik7DQpjb25zdCBodHRwXzEgPSByZXF1aXJlKCJAYW5ndWxhci9jb21tb24vaHR0cCIpOw0KY29uc3Qgb3BlcmF0b3JzXzEgPSByZXF1aXJlKCJyeGpzL29wZXJhdG9ycyIpOw0KY29uc3Qgcm91dGVyXzEgPSByZXF1aXJlKCJAYW5ndWxhci9yb3V0ZXIiKTsNCmNvbnN0IGxvZ2luX21vZGFsX3NlcnZpY2VfMSA9IHJlcXVpcmUoImFwcC9jb3JlL2xvZ2luL2xvZ2luLW1vZGFsLnNlcnZpY2UiKTsNCmNvbnN0IGxvZ2luX3NlcnZpY2VfMSA9IHJlcXVpcmUoImFwcC9jb3JlL2xvZ2luL2xvZ2luLnNlcnZpY2UiKTsNCmxldCBBdXRoRXhwaXJlZEludGVyY2VwdG9yID0gY2xhc3MgQXV0aEV4cGlyZWRJbnRlcmNlcHRvciB7DQogICAgY29uc3RydWN0b3IobG9naW5Nb2RhbFNlcnZpY2UsIHJvdXRlciwgbG9naW5TZXJ2aWNlKSB7DQogICAgICAgIHRoaXMubG9naW5Nb2RhbFNlcnZpY2UgPSBsb2dpbk1vZGFsU2VydmljZTsNCiAgICAgICAgdGhpcy5yb3V0ZXIgPSByb3V0ZXI7DQogICAgICAgIHRoaXMubG9naW5TZXJ2aWNlID0gbG9naW5TZXJ2aWNlOw0KICAgICAgICB0aGlzLk5PTl9DSEVDS0VEX1VSTFMgPSBbJy8nLCAnL3Jlc2V0L3JlcXVlc3QnLCAnL3Jlc2V0L2ZpbmlzaCddOw0KICAgIH0NCiAgICBpbnRlcmNlcHQocmVxdWVzdCwgbmV4dCkgew0KICAgICAgICByZXR1cm4gbmV4dC5oYW5kbGUocmVxdWVzdCkucGlwZShvcGVyYXRvcnNfMS50YXAoKGV2ZW50KSA9PiB7IH0sIChlcnIpID0+IHsNCiAgICAgICAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBodHRwXzEuSHR0cEVycm9yUmVzcG9uc2UpIHsNCiAgICAgICAgICAgICAgICBpZiAoZXJyLnN0YXR1cyA9PT0gNDAxKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmxvZ2luU2VydmljZS5pc0F1dGhlbnRpY2F0ZWQoKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dpblNlcnZpY2UubG9nb3V0RGlyZWN0bHkoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9naW5Nb2RhbFNlcnZpY2Uub3BlbigpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKCF0aGlzLk5PTl9DSEVDS0VEX1VSTFMuZmluZCh4ID0+IHRoaXMucm91dGVyLnVybC5zdGFydHNXaXRoKHgpKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dpblNlcnZpY2UubG9nb3V0KCk7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbJy8nXSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0pKTsNCiAgICB9DQp9Ow0KQXV0aEV4cGlyZWRJbnRlcmNlcHRvciA9IHRzbGliXzEuX19kZWNvcmF0ZShbDQogICAgY29yZV8xLkluamVjdGFibGUoKSwNCiAgICB0c2xpYl8xLl9fbWV0YWRhdGEoImRlc2lnbjpwYXJhbXR5cGVzIiwgW3R5cGVvZiAoX2EgPSB0eXBlb2YgbG9naW5fbW9kYWxfc2VydmljZV8xLkxvZ2luTW9kYWxTZXJ2aWNlICE9PSAidW5kZWZpbmVkIiAmJiBsb2dpbl9tb2RhbF9zZXJ2aWNlXzEuTG9naW5Nb2RhbFNlcnZpY2UpID09PSAiZnVuY3Rpb24iID8gX2EgOiBPYmplY3QsIHR5cGVvZiAoX2IgPSB0eXBlb2Ygcm91dGVyXzEuUm91dGVyICE9PSAidW5kZWZpbmVkIiAmJiByb3V0ZXJfMS5Sb3V0ZXIpID09PSAiZnVuY3Rpb24iID8gX2IgOiBPYmplY3QsIHR5cGVvZiAoX2MgPSB0eXBlb2YgbG9naW5fc2VydmljZV8xLkxvZ2luU2VydmljZSAhPT0gInVuZGVmaW5lZCIgJiYgbG9naW5fc2VydmljZV8xLkxvZ2luU2VydmljZSkgPT09ICJmdW5jdGlvbiIgPyBfYyA6IE9iamVjdF0pDQpdLCBBdXRoRXhwaXJlZEludGVyY2VwdG9yKTsNCmV4cG9ydHMuQXV0aEV4cGlyZWRJbnRlcmNlcHRvciA9IEF1dGhFeHBpcmVkSW50ZXJjZXB0b3I7DQo="},{"version":3,"file":"C:\\prgr\\orcid-member-services\\gateway\\src\\main\\webapp\\app\\blocks\\interceptor\\auth-expired.interceptor.ts","sourceRoot":"","sources":["C:\\prgr\\orcid-member-services\\gateway\\node_modules\\angular-router-loader\\src\\index.js!C:\\prgr\\orcid-member-services\\gateway\\node_modules\\tslint-loader\\index.js!C:\\prgr\\orcid-member-services\\gateway\\src\\main\\webapp\\app\\blocks\\interceptor\\auth-expired.interceptor.ts"],"names":[],"mappings":";;;;AAAA,wCAA2C;AAC3C,+CAA+G;AAE/G,8CAAqC;AACrC,4CAAyC;AAEzC,4EAAuE;AACvE,gEAA4D;AAG5D,IAAa,sBAAsB,GAAnC,MAAa,sBAAsB;IAGjC,YAAoB,iBAAoC,EAAU,MAAc,EAAU,YAA0B;QAAhG,sBAAiB,GAAjB,iBAAiB,CAAmB;QAAU,WAAM,GAAN,MAAM,CAAQ;QAAU,iBAAY,GAAZ,YAAY,CAAc;QAFpH,qBAAgB,GAAG,CAAC,GAAG,EAAE,gBAAgB,EAAE,eAAe,CAAC,CAAC;IAE2D,CAAC;IAExH,SAAS,CAAC,OAAyB,EAAE,IAAiB;QACpD,OAAO,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAC9B,eAAG,CACD,CAAC,KAAqB,EAAE,EAAE,GAAE,CAAC,EAC7B,CAAC,GAAQ,EAAE,EAAE;YACX,IAAI,GAAG,YAAY,wBAAiB,EAAE;gBACpC,IAAI,GAAG,CAAC,MAAM,KAAK,GAAG,EAAE;oBACtB,IAAI,IAAI,CAAC,YAAY,CAAC,eAAe,EAAE,EAAE;wBACvC,IAAI,CAAC,YAAY,CAAC,cAAc,EAAE,CAAC;wBACnC,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,CAAC;qBAC/B;yBAAM,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,EAAE;wBAC1E,IAAI,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC;wBAC3B,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;qBAC7B;iBACF;aACF;QACH,CAAC,CACF,CACF,CAAC;IACJ,CAAC;CACF,CAAA;AAzBY,sBAAsB;IADlC,iBAAU,EAAE;iEAI4B,uCAAiB,oBAAjB,uCAAiB,oDAAkB,eAAM,oBAAN,eAAM,oDAAwB,4BAAY,oBAAZ,4BAAY;GAHzG,sBAAsB,CAyBlC;AAzBY,wDAAsB","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpInterceptor, HttpRequest, HttpHandler, HttpEvent, HttpErrorResponse } from '@angular/common/http';\r\nimport { Observable } from 'rxjs';\r\nimport { tap } from 'rxjs/operators';\r\nimport { Router } from '@angular/router';\r\n\r\nimport { LoginModalService } from 'app/core/login/login-modal.service';\r\nimport { LoginService } from 'app/core/login/login.service';\r\n\r\n@Injectable()\r\nexport class AuthExpiredInterceptor implements HttpInterceptor {\r\n  NON_CHECKED_URLS = ['/', '/reset/request', '/reset/finish'];\r\n\r\n  constructor(private loginModalService: LoginModalService, private router: Router, private loginService: LoginService) {}\r\n\r\n  intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\r\n    return next.handle(request).pipe(\r\n      tap(\r\n        (event: HttpEvent<any>) => {},\r\n        (err: any) => {\r\n          if (err instanceof HttpErrorResponse) {\r\n            if (err.status === 401) {\r\n              if (this.loginService.isAuthenticated()) {\r\n                this.loginService.logoutDirectly();\r\n                this.loginModalService.open();\r\n              } else if (!this.NON_CHECKED_URLS.find(x => this.router.url.startsWith(x))) {\r\n                this.loginService.logout();\r\n                this.router.navigate(['/']);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      )\r\n    );\r\n  }\r\n}\r\n"]}]}